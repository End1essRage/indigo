bot:
  mode: "polling"
  debug: true
  admin: 7337303205 # –≤ –≤–∏–¥–µ —á–∏—Å–ª–∞

cache:
  type: "redis" #redis
  redis:
    address: "redis:6379"
    password: ""
    db: 0

storage:
  type: "mongo" #mongo
  file:
    path: "./e2e/storage"
  mongo:
    address: "mongo:27017"
    login: "admin"
    password: "password"
    db: "bot_db"

media:
  type: "local"

api:
  address: ":8080"
  endpoints:
    - path: "/webhook"
      method: "POST"
      scheme: "webhook_schema"
      script: "api/webhook.lua"
    - path: "/user/{id}"
      method: "GET"
      script: "api/get_user.lua"
  schemes:
    - name: "webhook_schema"
      fields:
        - name: "event"
          type: "string"
          required: true
          source: "body"
        - name: "user_id"
          type: "number"
          required: false
          source: "body"

#secrets:
#  - name: "api_key"
#  - name: "db_password"

commands:
  - name: "start"
    description: "–ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å –±–æ—Ç–æ–º"
    script: "commands/start"

  - name: "test_storage"
    description: "–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞"
    script: "commands/test_storage"

  - name: "test_cache"
    description: "–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–µ—à–∞"
    script: "commands/test_cache"

  - name: "test_http"
    description: "–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ HTTP"
    script: "commands/test_http"

  - name: "menu"
    description: "–º–µ–Ω—é"
    keyboard: "main_menu"

  - name: "profile"
    description: "–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å"
    form: "profile_form"

  - name: "search"
    description: "–ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"
    keyboard: "search_keyboard"

keyboards:
  - name: "main_menu"
    message: "–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:"
    buttons:
      - row:
          - text: "üìä –¢–µ—Å—Ç Storage"
            data: "test_storage"
            script: "commands/test_storage"
          - text: "üíæ –¢–µ—Å—Ç Cache"
            data: "test_cache"
            script: "commands/test_cache"
      - row:
          - text: "üåê –¢–µ—Å—Ç HTTP"
            data: "test_http"
            script: "commands/test_http"
          - text: "üë§ –ü—Ä–æ—Ñ–∏–ª—å"
            data: "profile"

  - name: "search_keyboard"
    message: "–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞:"
    buttons:
      - row:
          - text: "–ü–æ –∏–º–µ–Ω–∏"
            script: "search_by_name"
          - text: "–ü–æ –≥–æ—Ä–æ–¥—É"
            script: "search_by_city"
      - row:
          - text: "–ê–∫—Ç–∏–≤–Ω—ã–µ"
            data: "search_active"
          - text: "–í—Å–µ"
            data: "search_all"

forms:
  - name: "profile_form"
    description: "–ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è"
    stages:
      - field: "name"
        message: "–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è:"
        validation:
          type: "string"
          min_length: 2
          max_length: 50

      - field: "age"
        message: "–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –≤–æ–∑—Ä–∞—Å—Ç:"
        validation:
          type: "number"
          min: 14
          max: 120

      - field: "bio"
        message: "–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –æ —Å–µ–±–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):"
        validation:
          type: "string"
          max_length: 500
          required: false

    script: "save_profile"

#interceptors:
#  - affects: "all"
#    modules:
#      - "track_user"
#    scripts:
#      - "interceptors/log_all.lua"
#
#  - affects: "commands"
#    scripts:
#      - "interceptors/check_permissions.lua"
#
#  - affects: "text"
#    scripts:
#      - "interceptors/spam_filter.lua"

modules:
  - name: "track_user"
    cfg:
      collection: "user_activity"
      ttl: "86400"
